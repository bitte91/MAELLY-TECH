<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>MestreLÃºdico â€” Suporte ao Professor</title>
  <meta name="description" content="PWA rÃ¡pido e acessÃ­vel para preparar e conduzir aulas.">

  <!-- PWA & SEO -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#2D6AE3">
  <link rel="icon" href="/icons/favicon.ico" sizes="any">
  <link rel="icon" href="/icons/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2D6AE3">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Styles & Libs -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/hotkeys-js/dist/hotkeys.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.3/Sortable.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="header" aria-label="CabeÃ§alho do aplicativo">
      <div class="brand">
        <img src="/brand/logo.svg" alt="MestreLÃºdico Logo" style="height: 40px;">
      </div>
      <div class="toolbar" role="toolbar" aria-label="Ferramentas rÃ¡pidas">
        <button class="btn btn--ghost focus-ring" id="toggleTeaBtn" aria-pressed="false" title="Alternar Modo TEA">ğŸ§© Modo TEA</button>
        <button class="btn focus-ring" id="openExport">â¬‡ï¸ Exportar</button>
        <button class="btn btn--ghost focus-ring" id="exportJSON">ğŸ’¾ Exportar JSON</button>
        <label class="btn btn--ghost focus-ring" title="Importar JSON">
          ğŸ“¥ Importar JSON
          <input type="file" id="importJSON" accept="application/json" class="sr-only">
        </label>
      </div>
    </header>

    <nav class="tablist" role="tablist" aria-label="SeÃ§Ãµes principais">
      <button class="tab focus-ring" role="tab" aria-selected="true" aria-controls="tab-library" id="tab-library-btn">Biblioteca BNCC</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-workspace" id="tab-workspace-btn">Workspace</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-my" id="tab-my-btn">Minhas Atividades</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-chatbot" id="tab-chatbot-btn">Gerador de HistÃ³rias</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-quiz" id="tab-quiz-btn">Criador de Jogos</button>
    </nav>

    <section id="tab-library" role="tabpanel" aria-labelledby="tab-library-btn">
      <div class="card">
        <h3 class="section-title">Filtrar habilidades</h3>
        <div class="grid grid-3">
          <div>
            <label for="anoSel">Ano/SÃ©rie</label>
            <select id="anoSel" class="select focus-ring">
              <option>2Âº ano</option>
              <option>5Âº ano</option>
            </select>
          </div>
          <div>
            <label for="compSel">Componente</label>
            <select id="compSel" class="select focus-ring">
              <option>LÃ­ngua Portuguesa</option>
              <option>MatemÃ¡tica</option>
            </select>
          </div>
          <div>
            <label for="busca">Busca</label>
            <input id="busca" class="input focus-ring" placeholder="cÃ³digo, tema ou palavra-chave">
          </div>
        </div>
      </div>

      <div class="library" id="libraryList" aria-live="polite" aria-busy="false"></div>
      <p class="footer">Dica: arraste cards para o <strong>Workspace</strong>, ou use os botÃµes â€œAdicionarâ€. Atalhos: <span class="kbd">/</span> focar busca, <span class="kbd">g</span> Workspace.</p>
    </section>

    <section id="tab-workspace" role="tabpanel" aria-labelledby="tab-workspace-btn" hidden>
      <div class="card canvas">
        <h3 class="section-title">Plano de Aula â€” Workspace</h3>
        <div class="dropzones" aria-label="Zonas de construÃ§Ã£o do plano">
          <div class="dropzone" id="objectives-zone" data-section="objectives">
            <h4>ğŸ¯ Objetivos</h4>
            <div class="zone-list"></div>
          </div>
          <div class="dropzone" id="activities-zone" data-section="activities">
            <h4>ğŸ› ï¸ Atividades</h4>
            <div class="zone-list"></div>
          </div>
          <div class="dropzone" id="games-zone" data-section="games">
            <h4>ğŸ² Jogos</h4>
            <div class="zone-list"></div>
          </div>
          <div class="dropzone" id="assessments-zone" data-section="assessments">
            <h4>ğŸ“Š AvaliaÃ§Ãµes</h4>
            <div class="zone-list"></div>
          </div>
        </div>
        <hr class="sep">
        <div class="grid grid-2">
          <div class="card">
            <h4 class="section-title">PreferÃªncias do Plano</h4>
            <div class="grid">
              <label>Tema da Aula <input id="prefTheme" class="input focus-ring" placeholder="ex.: FraÃ§Ãµes no cotidiano"></label>
              <label>Turma <input id="prefClass" class="input focus-ring" placeholder="ex.: 5Âº ano A"></label>
              <label>DuraÃ§Ã£o <input id="prefTime" class="input focus-ring" placeholder="ex.: 50 minutos"></label>
            </div>
          </div>
          <div class="card">
            <h4 class="section-title">EstatÃ­sticas</h4>
            <p>Habilidades selecionadas: <strong id="statSkills">0</strong></p>
            <p>Itens no plano: <strong id="statItems">0</strong></p>
            <p>Modo TEA: <strong id="statTea">desligado</strong></p>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-my" role="tabpanel" aria-labelledby="tab-my-btn" hidden>
      <div class="card">
        <h3 class="section-title">Minhas Atividades</h3>
      <div class="custom-activity-adder">
        <div class="grid grid-2" style="margin-bottom: 8px;">
          <input id="customTitle" class="input focus-ring" placeholder="TÃ­tulo">
          <input id="customTags" class="input focus-ring" placeholder="Tags (opcional)">
        </div>
        <textarea id="customDescription" class="input focus-ring" placeholder="DescriÃ§Ã£o..." style="width:100%; box-sizing: border-box; margin-bottom: 8px;"></textarea>
          <button id="addCustom" class="btn">+ Adicionar</button>
        </div>
      </div>
      <div class="card" id="myActivitiesList"></div>
    </section>

    <section id="tab-chatbot" role="tabpanel" aria-labelledby="tab-chatbot-btn" hidden>
      <div class="card">
        <h3 class="section-title">Gerador de HistÃ³rias</h3>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages"></div>
          <div class="chat-input-area">
            <input type="text" id="chatInput" class="input focus-ring" placeholder="Digite sua resposta...">
            <button id="chatSendBtn" class="btn">Enviar</button>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-quiz" role="tabpanel" aria-labelledby="tab-quiz-btn" hidden>
      <div class="card">
        <h3 class="section-title">Criador de Quizzes</h3>
        <div id="quiz-editor">
          <label for="quizTitle" style="display: block; margin-bottom: 8px;">TÃ­tulo do Quiz</label>
          <input type="text" id="quizTitle" class="input focus-ring" placeholder="Ex: Capitais do Brasil" style="width: 100%;">
          <h4 style="margin-top: 1.5rem; margin-bottom: 1rem;">Perguntas</h4>
          <div id="questions-container"></div>
          <button id="addQuestionBtn" class="btn btn--ghost" style="margin-top: 1rem;">+ Adicionar Pergunta</button>
          <hr class="sep">
          <button id="saveQuizBtn" class="btn">Salvar Quiz</button>
        </div>
      </div>
      <div class="card" style="margin-top: 1rem;">
        <h3 class="section-title">Meus Quizzes Salvos</h3>
        <div id="quiz-list"></div>
      </div>
    </section>

    <dialog class="modal" id="exportModal" role="dialog" aria-modal="true" aria-labelledby="exportTitle">
      <div class="dialog">
        <h3 id="exportTitle" class="section-title">Exportar</h3>
        <p>Escolha o formato:</p>
        <div class="grid grid-3">
          <button class="btn" data-export="pdf">ğŸ“„ PDF (Workspace)</button>
          <button class="btn btn--ghost" data-export="csv">ğŸ“Š CSV (Planilha)</button>
          <button class="btn btn--ghost" data-export="json">ğŸ§° JSON (Completo)</button>
        </div>
        <p class="footer">O PDF captura a Ã¡rea do Workspace. Para melhor qualidade, expanda os itens antes de exportar.</p>
        <div style="text-align:right;margin-top:10px">
          <button class="btn btn--ghost" id="closeExport">Fechar</button>
        </div>
      </div>
    </dialog>

    <footer class="footer">Feito com â˜• e criticidade pedagÃ³gica.</footer>
  </div>

  <div id="quizPlayerModal" class="modal">
    <div class="dialog" style="max-width: 600px;">
      <div id="playerContent">
        <h3 id="playerQuizTitle" class="section-title">Carregando Quiz...</h3>
        <div id="playerQuestionContainer">
          <p id="playerQuestionText" style="font-size: 1.1rem; margin-bottom: 1.5rem;"></p>
          <div id="playerAnswersContainer" class="answers-container"></div>
        </div>
        <div id="playerFeedbackContainer" style="margin-top: 1.5rem; text-align: right;">
          <button id="playerNextBtn" class="btn" hidden>PrÃ³xima Pergunta</button>
        </div>
      </div>
      <div id="playerSummaryContainer" hidden>
        <h4 class="section-title">Fim do Quiz!</h4>
        <p>Sua pontuaÃ§Ã£o: <strong id="playerFinalScore"></strong></p>
        <button id="playerCloseBtn" class="btn">Fechar</button>
      </div>
    </div>
  </div>

  <script type="module" src="/assets/js/app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js");
    }
  </script>

  <div id="skillDetailModal" class="modal">
    <div class="dialog">
      <h3 id="skillDetailTitle" class="section-title"></h3>
      <p id="skillDetailDescription"></p>
      <hr class="sep">
      <h4>AÃ§Ãµes para esta Habilidade:</h4>
      <div id="skillDetailActions" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
        <!-- Action buttons will be injected by JS -->
      </div>
      <div style="text-align: right; margin-top: 1.5rem;">
        <button id="skillDetailCloseBtn" class="btn btn--ghost">Fechar</button>
      </div>
    </div>
  </div>

  <div id="aiSuggestionModal" class="modal">
    <div class="dialog" style="max-width: 650px;">
      <h3 class="section-title">SugestÃµes de Atividades com IA</h3>
      <div id="aiSuggestionContent">
        <p><strong>Habilidade da BNCC:</strong> <span id="aiSkillDescription"></span></p>
        <hr class="sep">
        <div id="aiSuggestionsList">
          <p>Carregando sugestÃµes...</p>
        </div>
      </div>
      <div style="text-align: right; margin-top: 1.5rem;">
        <button id="aiCloseBtn" class="btn btn--ghost">Fechar</button>
      </div>
    </div>
  </div>
</body>
</html>
