  <!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>MestreLúdico — Suporte ao Professor</title>
  <meta name="description" content="PWA rápido e acessível para preparar e conduzir aulas.">

  <!-- PWA & SEO -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#2D6AE3">
  <link rel="icon" href="/icons/favicon.ico" sizes="any">
  <link rel="icon" href="/icons/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#2D6AE3">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Styles & Libs -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/hotkeys-js/dist/hotkeys.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.3/Sortable.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="header" aria-label="Cabeçalho do aplicativo">
      <div class="brand">
        <img src="/brand/logo.svg" alt="MestreLúdico Logo" style="height: 40px;">
      </div>
      <div class="toolbar" role="toolbar" aria-label="Ferramentas rápidas">
        <button class="btn btn--ghost focus-ring" id="toggleTheme" data-tooltip="Alternar tema claro/escuro" data-tooltip-position="bottom">🌙 Tema</button>
        <button class="btn btn--ghost focus-ring" id="toggleBulkMode" aria-pressed="false" data-tooltip="Ativar/desativar modo de seleção múltipla (Ctrl+A)" data-tooltip-position="bottom">🗐️ Seleção</button>
        <button class="btn btn--ghost focus-ring" id="toggleTeaBtn" aria-pressed="false" data-tooltip="Alternar modo de adaptação para TEA (Ctrl+T)" data-tooltip-position="bottom">🧩 Modo TEA</button>
        <button class="btn focus-ring" id="openExport" data-tooltip="Abrir opções de exportação (Ctrl+E)" data-tooltip-position="bottom">⬇️ Exportar</button>
        <button class="btn btn--ghost focus-ring" id="exportJSON" data-tooltip="Exportação rápida em JSON (Ctrl+Shift+E)" data-tooltip-position="bottom">💾 Exportar JSON</button>
        <label class="btn btn--ghost focus-ring" data-tooltip="Importar configurações salvas" data-tooltip-position="bottom">
          📥 Importar JSON
          <input type="file" id="importJSON" accept="application/json" class="sr-only">
        </label>
      </div>
    </header>

    <nav class="tablist" role="tablist" aria-label="Seções principais">
      <button class="tab focus-ring" role="tab" aria-selected="true" aria-controls="tab-library" id="tab-library-btn" data-tooltip="Navegar pelas habilidades da BNCC (Alt+1)" data-tooltip-position="bottom">Biblioteca BNCC</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-workspace" id="tab-workspace-btn" data-tooltip="Área de construção do plano de aula (Alt+2)" data-tooltip-position="bottom">Workspace</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-my" id="tab-my-btn" data-tooltip="Gerenciar suas atividades personalizadas (Alt+3)" data-tooltip-position="bottom">Minhas Atividades</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-chatbot" id="tab-chatbot-btn" data-tooltip="Criar histórias interativas para as aulas (Alt+4)" data-tooltip-position="bottom">Gerador de Histórias</button>
      <button class="tab focus-ring" role="tab" aria-selected="false" aria-controls="tab-quiz" id="tab-quiz-btn" data-tooltip="Criar quizzes educativos (Alt+5)" data-tooltip-position="bottom">Criador de Jogos</button>
    </nav>

    <section id="tab-library" role="tabpanel" aria-labelledby="tab-library-btn">
      <div class="card">
        <h3 class="section-title">Filtrar habilidades</h3>
        <div class="grid grid-3">
          <div>
            <label for="anoSel">Ano/Série</label>
            <select id="anoSel" class="select focus-ring">
              <option>2º ano</option>
              <option>5º ano</option>
            </select>
          </div>
          <div>
            <label for="compSel">Componente</label>
            <select id="compSel" class="select focus-ring">
              <option>Língua Portuguesa</option>
              <option>Matemática</option>
            </select>
          </div>
          <div>
            <label for="busca">Busca</label>
            <input id="busca" class="input focus-ring" placeholder="código, tema ou palavra-chave">
          </div>
        </div>
        
        <!-- Advanced Search Filters -->
        <details class="advanced-search" id="advancedSearch">
          <summary class="search-toggle">Filtros Avançados</summary>
          <div class="advanced-filters">
            <div class="grid grid-4">
              <div>
                <label for="difficultyFilter">Dificuldade</label>
                <select id="difficultyFilter" class="select focus-ring">
                  <option value="">Todas</option>
                  <option value="facil">Fácil</option>
                  <option value="medio">Médio</option>
                  <option value="dificil">Difícil</option>
                </select>
              </div>
              <div>
                <label for="durationFilter">Duração (min)</label>
                <select id="durationFilter" class="select focus-ring">
                  <option value="">Qualquer</option>
                  <option value="0-30">0-30 min</option>
                  <option value="30-60">30-60 min</option>
                  <option value="60+">60+ min</option>
                </select>
              </div>
              <div>
                <label for="teaFilter">Adaptado para TEA</label>
                <select id="teaFilter" class="select focus-ring">
                  <option value="">Ambos</option>
                  <option value="yes">Sim</option>
                  <option value="no">Não</option>
                </select>
              </div>
              <div>
                <label for="sortBy">Ordenar por</label>
                <select id="sortBy" class="select focus-ring">
                  <option value="codigo">Código</option>
                  <option value="tema">Tema</option>
                  <option value="relevancia">Relevância</option>
                </select>
              </div>
            </div>
            <div class="search-actions">
              <button class="btn btn--sm" id="applyFilters">Aplicar Filtros</button>
              <button class="btn btn--sm btn--ghost" id="clearFilters">Limpar Filtros</button>
              <button class="btn btn--sm btn--ghost" id="saveSearch">Salvar Busca</button>
            </div>
          </div>
        </details>
        
        <!-- Saved Searches -->
        <div class="saved-searches" id="savedSearches" style="margin-top: 12px;"></div>
        
        <!-- Quick Filters -->
        <div class="quick-filters" style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
          <button class="btn btn--sm btn--ghost" id="filterFavorites" data-tooltip="Mostrar apenas favoritos">❤️ Favoritos</button>
          <button class="btn btn--sm btn--ghost" id="filterRecent" data-tooltip="Mostrar recentemente usados">🕑 Recentes</button>
          <button class="btn btn--sm btn--ghost" id="filterAll" data-tooltip="Mostrar todas as habilidades">📝 Todas</button>
        </div>
      </div>

      <div class="library" id="libraryList" aria-live="polite" aria-busy="false"></div>
      <p class="footer">Dica: arraste cards para o <strong>Workspace</strong>, ou use os botões "Adicionar". 
      Atalhos: <span class="kbd">Ctrl+F</span> busca, <span class="kbd">Ctrl+A</span> selecionar tudo, <span class="kbd">F1</span> ajuda completa.</p>
    </section>

    <section id="tab-workspace" role="tabpanel" aria-labelledby="tab-workspace-btn" hidden>
      <!-- Quick Templates Section -->
      <div class="card template-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <h3 class="section-title" style="margin: 0;">Modelos de Plano de Aula</h3>
          <button class="btn btn--danger btn--sm" id="resetWorkspace" data-tooltip="Limpar todo o workspace" data-tooltip-position="left">
            🗑️ Limpar Tudo
          </button>
        </div>
        <div class="template-grid">
          <button class="template-card" data-template="matematica-basica">
            <div class="template-icon">📊</div>
            <div class="template-title">Matemática Básica</div>
            <div class="template-desc">Operações fundamentais e resolução de problemas</div>
          </button>
          <button class="template-card" data-template="leitura-compreensao">
            <div class="template-icon">📚</div>
            <div class="template-title">Leitura e Compreensão</div>
            <div class="template-desc">Desenvolvimento de habilidades leitoras</div>
          </button>
          <button class="template-card" data-template="tea-adaptado">
            <div class="template-icon">🧩</div>
            <div class="template-title">Plano TEA</div>
            <div class="template-desc">Estruturado para alunos com TEA</div>
          </button>
          <button class="template-card" data-template="atividade-ludica">
            <div class="template-icon">🎲</div>
            <div class="template-title">Atividade Lúdica</div>
            <div class="template-desc">Aprendizado através de jogos</div>
          </button>
          <button class="template-card" data-template="avaliacao-formativa">
            <div class="template-icon">📝</div>
            <div class="template-title">Avaliação Formativa</div>
            <div class="template-desc">Acompanhamento contínuo do aprendizado</div>
          </button>
          <button class="template-card" data-template="personalizado">
            <div class="template-icon">⚙️</div>
            <div class="template-title">Criar Personalizado</div>
            <div class="template-desc">Começar do zero</div>
          </button>
        </div>
      </div>
      
      <div class="card canvas">
        <h3 class="section-title">Plano de Aula — Workspace</h3>
        <div class="dropzones" aria-label="Zonas de construção do plano">
          <div class="dropzone" id="objectives-zone" data-section="objectives">
            <h4>🎯 Objetivos</h4>
            <div class="zone-list"></div>
          </div>
          <div class="dropzone" id="activities-zone" data-section="activities">
            <h4>🛠️ Atividades</h4>
            <div class="zone-list"></div>
          </div>
          <div class="dropzone" id="games-zone" data-section="games">
            <h4>🎲 Jogos</h4>
            <div class="zone-list"></div>
          </div>
          <div class="dropzone" id="assessments-zone" data-section="assessments">
            <h4>📊 Avaliações</h4>
            <div class="zone-list"></div>
          </div>
        </div>
        <hr class="sep">
        <div class="grid grid-2">
          <div class="card">
            <h4 class="section-title">Preferências do Plano</h4>
            <div class="grid">
              <label>Tema da Aula <input id="prefTheme" class="input focus-ring" placeholder="ex.: Frações no cotidiano"></label>
              <label>Turma <input id="prefClass" class="input focus-ring" placeholder="ex.: 5º ano A"></label>
              <label>Duração <input id="prefTime" class="input focus-ring" placeholder="ex.: 50 minutos"></label>
            </div>
          </div>
          <div class="card">
            <h4 class="section-title">Estatísticas</h4>
            <p>Habilidades selecionadas: <strong id="statSkills">0</strong></p>
            <p>Itens no plano: <strong id="statItems">0</strong></p>
            <p>Modo TEA: <strong id="statTea">desligado</strong></p>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-my" role="tabpanel" aria-labelledby="tab-my-btn" hidden>
      <div class="card">
        <h3 class="section-title">Minhas Atividades</h3>
      <div class="custom-activity-adder">
        <div class="grid grid-2" style="margin-bottom: 8px;">
          <input id="customTitle" class="input focus-ring" placeholder="Título">
          <input id="customTags" class="input focus-ring" placeholder="Tags (opcional)">
        </div>
        <textarea id="customDescription" class="input focus-ring" placeholder="Descrição..." style="width:100%; box-sizing: border-box; margin-bottom: 8px;"></textarea>
          <button id="addCustom" class="btn">+ Adicionar</button>
        </div>
      </div>
      <div class="card" id="myActivitiesList"></div>
    </section>

    <section id="tab-chatbot" role="tabpanel" aria-labelledby="tab-chatbot-btn" hidden>
      <div class="card">
        <h3 class="section-title">Gerador de Histórias</h3>
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages"></div>
          <div class="chat-input-area">
            <input type="text" id="chatInput" class="input focus-ring" placeholder="Digite sua resposta...">
            <button id="chatSendBtn" class="btn">Enviar</button>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-quiz" role="tabpanel" aria-labelledby="tab-quiz-btn" hidden>
      <div class="card">
        <h3 class="section-title">Criador de Quizzes</h3>
        <div id="quiz-editor">
          <label for="quizTitle" style="display: block; margin-bottom: 8px;">Título do Quiz</label>
          <input type="text" id="quizTitle" class="input focus-ring" placeholder="Ex: Capitais do Brasil" style="width: 100%;">
          <h4 style="margin-top: 1.5rem; margin-bottom: 1rem;">Perguntas</h4>
          <div id="questions-container"></div>
          <button id="addQuestionBtn" class="btn btn--ghost" style="margin-top: 1rem;">+ Adicionar Pergunta</button>
          <hr class="sep">
          <button id="saveQuizBtn" class="btn">Salvar Quiz</button>
        </div>
      </div>
      <div class="card" style="margin-top: 1rem;">
        <h3 class="section-title">Meus Quizzes Salvos</h3>
        <div id="quiz-list"></div>
      </div>
    </section>

    <dialog class="modal" id="exportModal" role="dialog" aria-modal="true" aria-labelledby="exportTitle">
      <div class="dialog">
        <h3 id="exportTitle" class="section-title">Exportar</h3>
        <p>Escolha o formato:</p>
        <div class="grid grid-3">
          <button class="btn" data-export="pdf">📄 PDF (Workspace)</button>
          <button class="btn btn--ghost" data-export="csv">📊 CSV (Planilha)</button>
          <button class="btn btn--ghost" data-export="json">🧰 JSON (Completo)</button>
        </div>
        <p class="footer">O PDF captura a área do Workspace. Para melhor qualidade, expanda os itens antes de exportar.</p>
        <div style="text-align:right;margin-top:10px">
          <button class="btn btn--ghost" id="closeExport">Fechar</button>
        </div>
      </div>
    </dialog>

    <footer class="footer">Feito com ☕ e criticidade pedagógica.</footer>
  </div>

  <div id="quizPlayerModal" class="modal">
    <div class="dialog" style="max-width: 600px;">
      <div id="playerContent">
        <h3 id="playerQuizTitle" class="section-title">Carregando Quiz...</h3>
        <div id="playerQuestionContainer">
          <p id="playerQuestionText" style="font-size: 1.1rem; margin-bottom: 1.5rem;"></p>
          <div id="playerAnswersContainer" class="answers-container"></div>
        </div>
        <div id="playerFeedbackContainer" style="margin-top: 1.5rem; text-align: right;">
          <button id="playerNextBtn" class="btn" hidden>Próxima Pergunta</button>
        </div>
      </div>
      <div id="playerSummaryContainer" hidden>
        <h4 class="section-title">Fim do Quiz!</h4>
        <p>Sua pontuação: <strong id="playerFinalScore"></strong></p>
        <button id="playerCloseBtn" class="btn">Fechar</button>
      </div>
    </div>
  </div>

  <script type="module" src="/assets/js/app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js");
    }
  </script>

  <div id="skillDetailModal" class="modal">
    <div class="dialog">
      <h3 id="skillDetailTitle" class="section-title"></h3>
      <p id="skillDetailDescription"></p>
      <hr class="sep">
      <h4>Ações para esta Habilidade:</h4>
      <div id="skillDetailActions" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
        <!-- Action buttons will be injected by JS -->
      </div>
      <div style="text-align: right; margin-top: 1.5rem;">
        <button id="skillDetailCloseBtn" class="btn btn--ghost">Fechar</button>
      </div>
    </div>
  </div>

  <div id="aiSuggestionModal" class="modal">
    <div class="dialog" style="max-width: 650px;">
      <h3 class="section-title">Sugestões de Atividades com IA</h3>
      <div id="aiSuggestionContent">
        <p><strong>Habilidade da BNCC:</strong> <span id="aiSkillDescription"></span></p>
        <hr class="sep">
        <div id="aiSuggestionsList">
          <p>Carregando sugestões...</p>
        </div>
      </div>
      <div style="text-align: right; margin-top: 1.5rem;">
        <button id="aiCloseBtn" class="btn btn--ghost">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Toast Notifications Container -->
  <div id="toast-container" class="toast-container"></div>
  
  <!-- Back to Top Button -->
  <button id="backToTop" class="back-to-top" data-tooltip="Voltar ao topo" data-tooltip-position="left" aria-label="Voltar ao topo da página">
    ↑
  </button>
</body>
</html>
